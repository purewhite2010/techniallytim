<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Munin cgi graph timing outTechnically Tim</title>

    <link rel="stylesheet" href="http://tim.purewhite.id.au/theme/css/main.css">
    <link rel="stylesheet" href="http://tim.purewhite.id.au/theme/css/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <div><img src="" class="grv-img"/></div>
        <div class="title"><a href="http://tim.purewhite.id.au/">Technically Tim </a></div>
        <div class="sub-title"></div>

<p>
    <div class="view"><a href="http://tim.purewhite.id.au/about.html">About</a></div>
  <div class="view"><a href="http://tim.purewhite.id.au/archives.html">Archives</a></div>
</p>

<!-- Social links -->

      </header>
      <section>
<section id="content" class="body">
  <article>
      <div class="article-title">
        Munin cgi graph timing out
      </div>

    <div class="entry-content">
<p>
<small>
<abbr class="published" title="2011-09-01T11:50:00">
  Thu 01 September 2011
</abbr> | 
  tags: 
    <a href="http://tim.purewhite.id.au/tag/ipcrm">ipcrm</a>, 
    <a href="http://tim.purewhite.id.au/tag/ipcs">ipcs</a>, 
    <a href="http://tim.purewhite.id.au/tag/munin">munin</a>, 
    <a href="http://tim.purewhite.id.au/tag/munin-cgi-graph">munin-cgi-graph</a>, 
    <a href="http://tim.purewhite.id.au/tag/semaphore">semaphore</a>, 
    <a href="http://tim.purewhite.id.au/tag/timeout">timeout</a>, 
 -- (<a href="http://tim.purewhite.id.au/2011/09/munin-cgi-graph-timing-out/" rel="bookmark">permalink</a>)
</small>
</p>      <p>A problem that has given lots of people problems, caused me issues
yesterday. I have munin using munin-cgi-graph to create the graphs on
demand due to me not often viewing the graphs. A few days ago I had a
server issue that caused apache to lock up (I think a process ran away
with my RAM which caused swapping and apache to lock up.) Once I apache
running again, I wanted to check the munin graphs to see what the system
looked like during the lockup (which killed a number of processes due to
out of memory conditions). However, the graphs wouldn't generate and the
cgi was timing out without sending any data.</p>
<p><code>Timeout waiting for output from CGI script /usr/lib/cgi-bin/munin-cgi-graph Premature end of script headers: munin-cgi-graph</code></p>
<p>I'm not alone ether.
<a href="http://wiki.kartbuilding.net/index.php/Further_issues_upgrading_to_Lenny#munin_with_cgi">http://wiki.kartbuilding.net/index.php/Further_issues_upgrading_to_Lenny#munin_with_cgi</a>
and <a href="http://forum.linode.com/viewtopic.php?t=5171%3E">http://forum.linode.com/viewtopic.php?t=5171%3E</a> both had issues.
More googling still didn't find an answer so I tried to debug the perl
cgi. After using CPAN to get Devel:Trace installed, I discovered the cgi
was sitting waiting for a semaphore flag that it uses to ensure no more
than a certain number of munin-graphs are running at once. This is
great, except when a crash has caused this semaphore to be stuck at the
maximum so no more munin-graph processes get started ever!</p>
<p>There are 2 solutions. The first is simple, reboot. The second is also
simple, clear the semaphore flags manually. <code>ipcs</code> is the command to
show the flags and <code>ipcrm</code> is the command for removing the semaphores.
Check the man pages for information on the correct syntax.</p>
    </div><!-- /.entry-content -->
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'technicallytim.disqus.com'; // required: replace example with your forum shortname
        var disqus_identifier = "2011/09/munin-cgi-graph-timing-out/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </article>
</section>
      </section>
      <footer>
        <p><small>&copy; Technically Tim &mdash; Theme based on Sundown by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <!-- Scale fix -->
    <script>
      var metas = document.getElementsByTagName('meta');
      var i;
      
      if (navigator.userAgent.match(/iPhone/i)) {
        for (i=0; i<metas.length; i++) {
          if (metas[i].name == "viewport") {
            metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
          }
        }
      
        document.addEventListener("gesturestart", gestureStart, false);
      }

      function gestureStart() {
        for (i=0; i<metas.length; i++) {
          if (metas[i].name == "viewport") {
            metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
          }
        }
      }
    </script>
    <script type="text/javascript">
        var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.purewhite.id.au/" : "http://piwik.purewhite.id.au/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 4);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript><p><img src="http://piwik.purewhite.id.au/piwik.php?idsite=4" style="border:0" alt="" /></p></noscript>
  </body>
</html>